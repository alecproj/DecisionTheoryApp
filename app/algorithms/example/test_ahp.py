# test_ahp.py
from schema import validate_input
from ahp import run_ahp

# ← сюда вставить текст реального CSV-файла
# Для теста используем сокращённый пример (9 альтернатив, 4 критерия)
CSV_EXAMPLE = """\
;Легенда;;;;;;Сравнительная таблица важности критериев относительно друг друга;;;;;;;;;;;;;;;;;;;;
;Цвет;Тип пользовательского ввода;;;;;;ЦЕНА 1;ЦЕНА 2;ЦЕНА 3;ЦЕНА 4;;;;;;;;;;;;;;;;
;;строка;;;;;ЦЕНА 1;1;2;3;2;;;;;;;;;;;;;;;;
;;целое число от 0 до 5;;;;;ЦЕНА 2;0,5;1;3;2;;;;;;;;;;;;;;;;
;;произвольное число;;;;;ЦЕНА 3;0,333333333;0,333333333;1;2;;;;;;;;;;;;;;;;
;;0 или 1;;;;;ЦЕНА 4;0,5;0,5;0,5;1;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;Названия альтернатив;;;Названия критериев;;;;;;;;;;;;;;;;;;;;;;;
;Альтернатива;Название альтернативы;;Критерий;Название критерия;;;;;;;;;;;;;;;;;;;;;;
;А1;КВАРТИРА 1;;К1;ЦЕНА 1;;;;;;;;;;;;;;;;;;;;;;
;А2;КВАРТИРА 2;;К2;ЦЕНА 2;;;;;;;;;;;;;;;;;;;;;;
;А3;КВАРТИРА 3;;К3;ЦЕНА 3;;;;;;;;;;;;;;;;;;;;;;
;А4;КВАРТИРА 4;;К4;ЦЕНА 4;;;;;;;;;;;;;;;;;;;;;;
;А5;КВАРТИРА 5;;;;;;;;;;;;;;;;;;;;;;;;;
;А6;КВАРТИРА 6;;;;;;;;;;;;;;;;;;;;;;;;;
;А7;КВАРТИРА 7;;;;;;;;;;;;;;;;;;;;;;;;;
;А8;КВАРТИРА 8;;;;;;;;;;;;;;;;;;;;;;;;;
;А9;КВАРТИРА 9;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;Значения критериев;;;;;;;;;;;;;;;;;;;;
;;;;;;;;КВАРТИРА 1;КВАРТИРА 2;КВАРТИРА 3;КВАРТИРА 4;КВАРТИРА 5;КВАРТИРА 6;КВАРТИРА 7;КВАРТИРА 8;КВАРТИРА 9;;;;;;;;;;;Сортировать по возрастанию?
;;;;;;;ЦЕНА 1;1,2;13,2;1,2;1,2;1,2;1,2;1,2;1,2;45645461,32131332;;;;;;;;;;;1
;;;;;;;ЦЕНА 2;5322;53;53;53;53;53;53;53;53;;;;;;;;;;;1
;;;;;;;ЦЕНА 3;11;11;11;11;11;11;11;11;121;;;;;;;;;;;1
;;;;;;;ЦЕНА 4;900;900;900;900;900;900;900;900;900;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;1
"""

def main():
    fake_input = {"csv": CSV_EXAMPLE}

    try:
        # Валидация и парсинг
        parsed = validate_input(fake_input)
        print("Парсинг прошёл успешно!")

        # Вывод базовых данных
        print("\n=== Основные данные ===")
        print(f"Количество критериев (m): {parsed.m}")
        print(f"Количество альтернатив (n): {parsed.n}")
        print("\nКритерии:")
        for i, name in enumerate(parsed.criteria_names, 1):
            print(f"  {i}. {name}")
        print("\nАльтернативы:")
        for i, name in enumerate(parsed.alternative_names, 1):
            print(f"  {i}. {name}")

        print("\nМатрица парных сравнений критериев (pairwise):")
        for row in parsed.pairwise:
            print([round(x, 3) for x in row])

        print("\nМатрица прямых оценок (scores):")
        for i, row in enumerate(parsed.scores):
            print(f"Критерий {i+1} ({parsed.criteria_names[i]}):")
            print([round(x, 2) for x in row])

        # Рассчёт и вывод m матриц сравнения альтернатив
        print("\n=== Матрицы сравнения альтернатив по критериям ===")
        ahp_result = run_ahp(parsed)
        for k in range(ahp_result.m):
            print(f"\nДля критерия {k+1} ({ahp_result.criteria_names[k]}):")
            mat = ahp_result.alternative_pairwise[k]
            for row in mat:
                print([round(x, 3) for x in row])

    except ValueError as e:
        print("Ошибка валидации:")
        print(e)
    except Exception as e:
        print("Неожиданная ошибка:")
        print(type(e).__name__, str(e))


if __name__ == "__main__":
    main()