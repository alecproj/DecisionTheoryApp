# test_ahp.py
from schema import validate_input
from ahp import run_ahp

# ← сюда вставить текст реального CSV-файла
# Для теста используем сокращённый пример (9 альтернатив, 4 критерия)
CSV_EXAMPLE = """\
;Легенда;;;;;;Сравнительная таблица важности критериев относительно друг друга;;;;;;;;;;;;;;;;;;;;
;Цвет;Тип пользовательского ввода;;;;;;ЦЕНА;РАЗМЕР;КОМНАТЫ;БЛИЗОСТЬ;КАТЕГОРИЯ;0;0;0;0;;;;;;;;;;;
;;строка;;;;;ЦЕНА;1;3,00;1;0,50;5;;;;;;;;;;;;;;;
;;целое число от 0 до 5;;;;;РАЗМЕР;0,333333333;1;0,25;0,14;2;;;;;;;;;;;;;;;
;;произвольное число;;;;;КОМНАТЫ;1;4;1;1;6;;;;;;;;;;;;;;;
;;0 или 1;;;;;БЛИЗОСТЬ;2;7;1;1;8;;;;;;;;;;;;;;;
;;;;;;;КАТЕГОРИЯ;0,2;0,5;0,166666667;0,125;1;;;;;;;;;;;;;;;
;Названия альтернатив;;;Названия критериев;;;;;;;;;;;;;;;;;;;;;;;
;Альтернатива;Название альтернативы;;Критерий;Название критерия;;;;;;;;;;;;;;;;;;;;;;
;А1;КВАРТИРА 1;;К1;ЦЕНА;;;;;;;;;;;;;;;;;;;;;;
;А2;КВАРТИРА 2;;К2;РАЗМЕР;;;;;;;;;;;;;;;;;;;;;;
;А3;КВАРТИРА 3;;К3;КОМНАТЫ;;;;;;;;;;;;;;;;;;;;;;
;;;;K4;БЛИЗОСТЬ;;;;;;;;;;;;;;;;;;;;;;
;;;;К5;КАТЕГОРИЯ;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;Значения критериев;;;;;;;;;;;;;;;;;;;;
;;;;;;;;КВАРТИРА 1;КВАРТИРА 2;КВАРТИРА 3;0;0;0;0;0;0;;;;;;;;;;;Сортировать по возрастанию?
;;;;;;;ЦЕНА;333;100;500;;;;;;;;;;;;;;;;;0
;;;;;;;РАЗМЕР;80;140;30;;;;;;;;;;;;;;;;;1
;;;;;;;КОМНАТЫ;22,9;25,9;10;;;;;;;;;;;;;;;;;1
;;;;;;;БЛИЗОСТЬ;31,1;70;10;;;;;;;;;;;;;;;;;1
;;;;;;;КАТЕГОРИЯ;17;10;73;;;;;;;;;;;;;;;;;1
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;
"""

def main():
    fake_input = {"csv": CSV_EXAMPLE}

    try:
        # Валидация и парсинг
        parsed = validate_input(fake_input)
        print("Парсинг прошёл успешно!")

        # Вывод базовых данных
        print("\n=== Основные данные ===")
        print(f"Количество критериев (m): {parsed.m}")
        print(f"Количество альтернатив (n): {parsed.n}")
        print("\nКритерии:")
        for i, name in enumerate(parsed.criteria_names, 1):
            print(f"  {i}. {name}")
        print("\nАльтернативы:")
        for i, name in enumerate(parsed.alternative_names, 1):
            print(f"  {i}. {name}")

        print("\nМатрица парных сравнений критериев (pairwise):")
        for row in parsed.pairwise:
            print([round(x, 3) for x in row])

        print("\nМатрица прямых оценок (scores):")
        for i, row in enumerate(parsed.scores):
            print(f"Критерий {i+1} ({parsed.criteria_names[i]}):")
            print([round(x, 2) for x in row])

        # Рассчёт и вывод m матриц сравнения альтернатив
        print("\n=== Матрицы сравнения альтернатив по критериям ===")
        ahp_result = run_ahp(parsed)
        print(ahp_result)

    except ValueError as e:
        print("Ошибка валидации:")
        print(e)
    except Exception as e:
        print("Неожиданная ошибка:")
        print(type(e).__name__, str(e))


if __name__ == "__main__":
    main()